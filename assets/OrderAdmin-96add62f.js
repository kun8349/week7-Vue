import{S as u}from"./sweetalert2.all-b5115aad.js";import{m as $,P as w,D as L}from"./PaginationView-39a2cc7a.js";import{_ as y,o as n,c as d,a as t,A as o,E as D,F as _,z as b,B as k,I as P,b as p,w as I,r as h,D as E}from"./index-806c1ca4.js";import{_ as U}from"./loading-26e6df6d.js";const V={props:{productOrder:{type:Object,default(){return{}}}},data(){return{tempProduct:{}}},mixins:[$],emits:["update-order-status"],watch:{productOrder(){this.tempProduct=this.$props.productOrder}}},B={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl"},A={class:"modal-content"},T=t("div",{class:"modal-header bg-dark text-white"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"訂單細節"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},R={class:"row"},N={class:"col-4"},z=t("h2",null,"用戶資料",-1),F={class:"table mt-2"},H={key:0},q=t("th",{style:{width:"100px"}},"姓名",-1),G=t("th",null,"email",-1),J=t("th",null,"電話",-1),K=t("th",null,"地址",-1),Q={class:"col-8"},W=t("h2",null,"訂單細節",-1),X={class:"table mt-2"},Y=t("th",{style:{width:"100px"}},"訂單編號",-1),Z=t("th",null,"下單時間",-1),tt=t("th",null,"付款時間",-1),et={key:0},ot={key:1},st=t("th",null,"付款狀態",-1),nt={key:0,class:"text-success"},dt={key:1},lt=t("th",null,"總金額",-1),rt=t("h2",null,"選購商品",-1),it={class:"table mt-2"},at={class:"text-end"},ct={class:"form-check d-flex justify-content-end"},ut={class:"form-check-label",for:"flexCheckIndeterminate"},pt={key:0},ht={key:1},_t={class:"modal-footer"},mt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function ft(l,r,g,C,e,a){return n(),d("div",B,[t("div",S,[t("div",A,[T,t("div",j,[t("div",R,[t("div",N,[z,t("table",F,[e.tempProduct.user?(n(),d("tbody",H,[t("tr",null,[q,t("td",null,o(e.tempProduct.user.name),1)]),t("tr",null,[G,t("td",null,o(e.tempProduct.user.email),1)]),t("tr",null,[J,t("td",null,o(e.tempProduct.user.tel),1)]),t("tr",null,[K,t("td",null,o(e.tempProduct.user.address),1)])])):D("",!0)])]),t("div",Q,[W,t("table",X,[t("tbody",null,[t("tr",null,[Y,t("td",null,o(e.tempProduct.id),1)]),t("tr",null,[Z,t("td",null,o(l.$filters.date(e.tempProduct.create_at)),1)]),t("tr",null,[tt,t("td",null,[e.tempProduct.paid_date?(n(),d("span",et,o(e.tempProduct.paid_date),1)):(n(),d("span",ot,"時間不正確"))])]),t("tr",null,[st,t("td",null,[e.tempProduct.is_paid?(n(),d("span",nt," 完成付款 ")):(n(),d("span",dt,"尚未付款"))])]),t("tr",null,[lt,t("td",null,"$"+o(e.tempProduct.total),1)])])]),rt,t("table",it,[t("tbody",null,[(n(!0),d(_,null,b(e.tempProduct.products,i=>(n(),d("tr",{key:i.id+"訂單產品"},[t("th",null,o(i.product.title),1),t("td",null,o(i.product.num)+" / "+o(i.product.unit),1),t("td",at,"$"+o(i.total),1)]))),128))])])]),t("div",ct,[k(t("input",{class:"form-check-input",type:"checkbox",id:"flexCheckIndeterminate","onUpdate:modelValue":r[0]||(r[0]=i=>e.tempProduct.is_paid=i)},null,512),[[P,e.tempProduct.is_paid]]),t("label",ut,[e.tempProduct.is_paid?(n(),d("span",pt,"完成付款")):(n(),d("span",ht,"未付款"))])])])]),t("div",_t,[mt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=()=>l.$emit("update-order-status",e.tempProduct))}," 修改付款狀態 ")])])])],512)}const bt=y(V,[["render",ft]]),{VITE_URL:m,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"kevin-jiang",BASE_URL:"/week7-Vue/",MODE:"production",DEV:!1,PROD:!0},gt={data(){return{orders:{},tempOrder:{},isLoading:!1,isUpdatingLoading:!1,loadingItem:"",pages:{},currentPage:1}},components:{ModalOrder:bt,Pagination:w,DelModal:L},methods:{getOrders(l=1){this.currentPage=l,this.isUpdatingLoading||(this.isLoading=!0),this.$http.get(`${m}api/${f}/admin/orders/?page=${l}`).then(r=>{this.orders=r.data.orders,this.pages=r.data.pagination,this.isLoading=!1}).catch(()=>{u.fire({position:"top-end",icon:"error",title:"資料取得失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},changeOrderStatus(l){this.isUpdatingLoading=!0;const r={is_paid:l.is_paid};this.loadingItem=l.id,this.$http.put(`${m}api/${f}/admin/order/${l.id}`,{data:r}).then(()=>{this.loadingItem="",u.fire({position:"top-end",icon:"success",title:"訂單修改成功(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0}),this.getOrders(),this.$refs.orderModal.hideModal()}).catch(()=>{u.fire({position:"top-end",icon:"error",title:"訂單修改失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},openModal(l){this.tempOrder={...l},this.$refs.orderModal.openModal()},openDelModal(l){this.tempOrder={...l},this.$refs.delModal.openModal()},delOrder(){this.$http.delete(`${m}api/${f}/admin/order/${this.tempOrder.id}`).then(l=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage),u.fire({position:"top-end",icon:"success",title:"成功刪除單一產品d(`･∀･)b",showConfirmButton:!1,timer:1500,toast:!0})}).catch(()=>{u.fire({icon:"success",title:"刪除單一品項失敗٩(ŏ﹏ŏ、)۶",showConfirmButton:!1,timer:1500})})}},mounted(){this.getOrders()}},yt=t("img",{src:U,alt:"loading"},null,-1),kt={class:"table mt-4"},Pt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"購買款項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"是否付款"),t("th",{scope:"col"},"編輯")])],-1),Ct={class:"table-group-divider"},Ot={class:"list-unstyled"},Mt={class:"form-check form-switch"},xt=["id","onUpdate:modelValue","onChange","disabled"],vt=["for"],$t={key:0},wt={key:1},Lt={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},Dt=["onClick"],It=["onClick"],Et={class:"d-flex justify-content-center"};function Ut(l,r,g,C,e,a){const i=h("AppLoading"),O=h("Pagination"),M=h("ModalOrder"),x=h("DelModal");return n(),d(_,null,[p(i,{active:e.isLoading,"onUpdate:active":r[0]||(r[0]=s=>e.isLoading=s)},{default:I(()=>[yt]),_:1},8,["active"]),t("table",kt,[Pt,t("tbody",Ct,[(n(!0),d(_,null,b(e.orders,s=>(n(),d("tr",{key:s.id+"後台訂單列表",class:E({"text-secondary":!s.is_paid})},[t("td",null,o(l.$filters.date(s.create_at)),1),t("td",null,o(s.user.email),1),t("td",null,[t("ul",Ot,[(n(!0),d(_,null,b(s.products,(c,v)=>(n(),d("li",{key:v+"訂單"},o(c.product.title)+"數量 : "+o(c.qty)+" "+o(c.product.unit),1))),128))])]),t("td",null,"$"+o(s.total),1),t("td",null,[t("div",Mt,[k(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`orderSwitch${s.id}`,"onUpdate:modelValue":c=>s.is_paid=c,onChange:()=>a.changeOrderStatus(s),disabled:e.loadingItem===s.id},null,40,xt),[[P,s.is_paid]]),t("label",{class:"form-check-label",for:`orderSwitch${s.id}`},[s.is_paid?(n(),d("span",$t,"已付款")):(n(),d("span",wt,"未付款"))],8,vt)])]),t("td",null,[t("div",Lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>a.openModal(s)}," 檢視 ",8,Dt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>a.openDelModal(s)}," 刪除 ",8,It)])])],2))),128))])]),t("div",Et,[p(O,{pages:e.pages,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"])]),p(M,{onUpdateOrderStatus:a.changeOrderStatus,"product-order":e.tempOrder,ref:"orderModal"},null,8,["onUpdateOrderStatus","product-order"]),p(x,{item:e.tempOrder,onDelItem:a.delOrder,ref:"delModal"},null,8,["item","onDelItem"])],64)}const Tt=y(gt,[["render",Ut]]);export{Tt as default};
