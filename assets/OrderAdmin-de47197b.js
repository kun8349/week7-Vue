import{S as _}from"./sweetalert2.all-cd4a28e1.js";import{m as $,P as w,D as L}from"./PaginationView-398dbfd5.js";import{_ as y,o as d,c as l,a as t,A as s,E as D,F as h,z as f,B as k,I as P,b as u,w as I,r as p,D as E}from"./index-45e5e989.js";import{_ as U}from"./loading-26e6df6d.js";import"./_commonjsHelpers-28e086c5.js";const V={props:{productOrder:{type:Object,default(){return{}}}},data(){return{tempProduct:{}}},mixins:[$],emits:["update-order-status"],watch:{productOrder(){this.tempProduct=this.$props.productOrder}}},S={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-xl"},A={class:"modal-content"},T=t("div",{class:"modal-header bg-dark text-white"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"訂單細節"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},R={class:"row"},N={class:"col-4"},z=t("h2",null,"用戶資料",-1),F={class:"table mt-2"},H={key:0},q=t("th",{style:{width:"100px"}},"姓名",-1),G=t("th",null,"email",-1),J=t("th",null,"電話",-1),K=t("th",null,"地址",-1),Q={class:"col-8"},W=t("h2",null,"訂單細節",-1),X={class:"table mt-2"},Y=t("th",{style:{width:"100px"}},"訂單編號",-1),Z=t("th",null,"下單時間",-1),tt=t("th",null,"付款時間",-1),et={key:0},ot={key:1},st=t("th",null,"付款狀態",-1),nt={key:0,class:"text-success"},dt={key:1},lt=t("th",null,"總金額",-1),rt=t("h2",null,"選購商品",-1),it={class:"table mt-2"},at={class:"text-end"},ct={class:"form-check d-flex justify-content-end"},ut={class:"form-check-label",for:"flexCheckIndeterminate"},pt={key:0},ht={key:1},_t={class:"modal-footer"},mt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function bt(o,r,g,O,e,a){return d(),l("div",S,[t("div",B,[t("div",A,[T,t("div",j,[t("div",R,[t("div",N,[z,t("table",F,[e.tempProduct.user?(d(),l("tbody",H,[t("tr",null,[q,t("td",null,s(e.tempProduct.user.name),1)]),t("tr",null,[G,t("td",null,s(e.tempProduct.user.email),1)]),t("tr",null,[J,t("td",null,s(e.tempProduct.user.tel),1)]),t("tr",null,[K,t("td",null,s(e.tempProduct.user.address),1)])])):D("",!0)])]),t("div",Q,[W,t("table",X,[t("tbody",null,[t("tr",null,[Y,t("td",null,s(e.tempProduct.id),1)]),t("tr",null,[Z,t("td",null,s(o.$filters.date(e.tempProduct.create_at)),1)]),t("tr",null,[tt,t("td",null,[e.tempProduct.paid_date?(d(),l("span",et,s(e.tempProduct.paid_date),1)):(d(),l("span",ot,"時間不正確"))])]),t("tr",null,[st,t("td",null,[e.tempProduct.is_paid?(d(),l("span",nt," 完成付款 ")):(d(),l("span",dt,"尚未付款"))])]),t("tr",null,[lt,t("td",null,"$"+s(e.tempProduct.total),1)])])]),rt,t("table",it,[t("tbody",null,[(d(!0),l(h,null,f(e.tempProduct.products,i=>(d(),l("tr",{key:i.id+"訂單產品"},[t("th",null,s(i.product.title),1),t("td",null,s(i.product.num)+" / "+s(i.product.unit),1),t("td",at,"$"+s(i.total),1)]))),128))])])]),t("div",ct,[k(t("input",{class:"form-check-input",type:"checkbox",id:"flexCheckIndeterminate","onUpdate:modelValue":r[0]||(r[0]=i=>e.tempProduct.is_paid=i)},null,512),[[P,e.tempProduct.is_paid]]),t("label",ut,[e.tempProduct.is_paid?(d(),l("span",pt,"完成付款")):(d(),l("span",ht,"未付款"))])])])]),t("div",_t,[mt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=()=>o.$emit("update-order-status",e.tempProduct))}," 修改付款狀態 ")])])])],512)}const ft=y(V,[["render",bt]]),{VITE_URL:m,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"kevin-jiang",BASE_URL:"/week7-Vue/",MODE:"production",DEV:!1,PROD:!0},gt={data(){return{orders:{},tempOrder:{},isLoading:!1,isUpdatingLoading:!1,loadingItem:"",pages:{},currentPage:1}},components:{ModalOrder:ft,Pagination:w,DelModal:L},methods:{getOrders(o=1){this.currentPage=o,this.isUpdatingLoading||(this.isLoading=!0),this.$http.get(`${m}api/${b}/admin/orders/?page=${o}`).then(r=>{this.orders=r.data.orders,this.pages=r.data.pagination,this.isLoading=!1}).catch(()=>{_.fire({position:"top-end",icon:"error",title:"資料取得失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},changeOrderStatus(o){this.isUpdatingLoading=!0;const r={is_paid:o.is_paid};this.loadingItem=o.id,this.$http.put(`${m}api/${b}/admin/order/${o.id}`,{data:r}).then(()=>{this.loadingItem="",_.fire({position:"top-end",icon:"success",title:"訂單修改成功(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0}),this.getOrders(),this.$refs.orderModal.hideModal()}).catch(()=>{_.fire({position:"top-end",icon:"error",title:"訂單修改失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},openModal(o){this.tempOrder={...o},this.$refs.orderModal.openModal()},openDelModal(o){this.tempOrder={...o},this.$refs.delModal.openModal()},delOrder(){this.$http.delete(`${m}api/${b}/admin/order/${this.tempOrder.id}`).then(o=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage)}).catch(o=>{console.log(o)})}},mounted(){this.getOrders()}},yt=t("img",{src:U,alt:"loading"},null,-1),kt={class:"table mt-4"},Pt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"購買款項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"是否付款"),t("th",{scope:"col"},"編輯")])],-1),Ot={class:"table-group-divider"},Ct={class:"list-unstyled"},Mt={class:"form-check form-switch"},xt=["id","onUpdate:modelValue","onChange","disabled"],vt=["for"],$t={key:0},wt={key:1},Lt={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},Dt=["onClick"],It=["onClick"],Et={class:"d-flex justify-content-center"};function Ut(o,r,g,O,e,a){const i=p("AppLoading"),C=p("Pagination"),M=p("ModalOrder"),x=p("DelModal");return d(),l(h,null,[u(i,{active:e.isLoading,"onUpdate:active":r[0]||(r[0]=n=>e.isLoading=n)},{default:I(()=>[yt]),_:1},8,["active"]),t("table",kt,[Pt,t("tbody",Ot,[(d(!0),l(h,null,f(e.orders,n=>(d(),l("tr",{key:n.id+"後台訂單列表",class:E({"text-secondary":!n.is_paid})},[t("td",null,s(o.$filters.date(n.create_at)),1),t("td",null,s(n.user.email),1),t("td",null,[t("ul",Ct,[(d(!0),l(h,null,f(n.products,(c,v)=>(d(),l("li",{key:v+"訂單"},s(c.product.title)+"數量 : "+s(c.qty)+" "+s(c.product.unit),1))),128))])]),t("td",null,"$"+s(n.total),1),t("td",null,[t("div",Mt,[k(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`orderSwitch${n.id}`,"onUpdate:modelValue":c=>n.is_paid=c,onChange:()=>a.changeOrderStatus(n),disabled:e.loadingItem===n.id},null,40,xt),[[P,n.is_paid]]),t("label",{class:"form-check-label",for:`orderSwitch${n.id}`},[n.is_paid?(d(),l("span",$t,"已付款")):(d(),l("span",wt,"未付款"))],8,vt)])]),t("td",null,[t("div",Lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>a.openModal(n)}," 檢視 ",8,Dt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>a.openDelModal(n)}," 刪除 ",8,It)])])],2))),128))])]),t("div",Et,[u(C,{pages:e.pages,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"])]),u(M,{onUpdateOrderStatus:a.changeOrderStatus,"product-order":e.tempOrder,ref:"orderModal"},null,8,["onUpdateOrderStatus","product-order"]),u(x,{item:e.tempOrder,onDelItem:a.delOrder,ref:"delModal"},null,8,["item","onDelItem"])],64)}const jt=y(gt,[["render",Ut]]);export{jt as default};
